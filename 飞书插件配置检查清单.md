# 飞书插件配置检查清单

**创建时间**: 2026-02-09 07:50 GMT+8
**目的**: 确保飞书开放平台配置完整，避免网关启动问题

---

## ✅ 配置文件已更新

`/home/ubuntu/.openclaw/openclaw.json` 已更新为新格式：

```json
"feishu": {
  "enabled": false,  // ← 暂时禁用，等您检查完飞书平台后再启用
  "accounts": {
    "main": {
      "appId": "cli_a90f653e28b81bd1",
      "appSecret": "qT9iVZXWSSU6CIn0tGO0nMmlWa4cNehg"
    }
  },
  "dmPolicy": "pairing",
  "groupPolicy": "open",
  "streaming": true
}
```

---

## 🔍 飞书开放平台检查清单

请访问 [飞书开放平台](https://open.feishu.cn/app) 并检查以下项目：

### 1. 基础信息 ✅
- [x] App已创建
- [x] App ID: `cli_a90f653e28b81bd1`
- [x] App Secret已保存

### 2. 权限配置（重要！）⚠️
- [ ] **批量导入权限**：复制以下JSON到权限配置
```json
{
  "scopes": {
    "tenant": [
      "im:message",
      "im:message:send_as_bot",
      "im:message:readonly",
      "im:message.p2p_msg:readonly",
      "im:message.group_at_msg:readonly",
      "im:chat.access_event.bot_p2p_chat:read",
      "im:chat.members:bot_access",
      "im:resource",
      "application:application.self_manage",
      "application:bot.menu:write"
    ]
  }
}
```
- [ ] 确认所有权限已批准

### 3. Bot能力 ⚠️
- [ ] **启用Bot能力**
- [ ] **设置Bot名称**（例如：贾维斯）
- [ ] **Bot描述**（可选）

### 4. 事件订阅（关键！）⚠️⚠️⚠️
- [ ] **选择"使用长连接接收事件"（WebSocket）**
- [ ] **添加事件**：`im.message.receive_v1`
- [ ] **保存配置**

⚠️ **重要提示**：
- 事件订阅必须在网关运行时配置
- 如果网关未运行，长连接设置可能失败
- 这是之前网关崩溃的**最可能原因**

### 5. 版本发布 ⚠️
- [ ] **创建版本**
- [ ] **提交审核**
- [ ] **发布应用**

---

## 🚀 启用流程（按顺序）

### 第1步：检查飞书平台配置
完成上面的检查清单，确保所有项目都已勾选 ✅

### 第2步：准备启用网关
告诉贾维斯："飞书配置已检查完毕，准备启用"

贾维斯会：
1. 启用feishu插件（`enabled: true`）
2. 重启网关
3. 监控日志查看启动状态

### 第3步：配置事件订阅
⚠️ **重要**：在网关运行后再配置事件订阅！

贾维斯会提供命令让您监控日志：
```bash
openclaw logs --follow
```

### 第4步：测试连接
1. 在飞书中找到Bot
2. 发送测试消息
3. 批准配对（如果需要）

---

## 🐛 故障排除

### 如果网关启动失败

**检查日志**：
```bash
openclaw logs --follow
```

**常见错误**：

1. **"WebSocket connection failed"**
   - 原因：事件订阅未配置或配置错误
   - 解决：在飞书开放平台配置事件订阅

2. **"App authentication failed"**
   - 原因：App ID或Secret错误
   - 解决：检查配置文件中的凭据

3. **"Permission denied"**
   - 原因：权限配置不完整
   - 解决：导入完整的权限JSON

4. **"App not published"**
   - 原因：应用未发布
   - 解决：在版本管理中发布应用

---

## 📋 快速命令参考

```bash
# 查看网关状态
openclaw gateway status

# 重启网关
openclaw gateway restart

# 查看日志
openclaw logs --follow

# 查看配对请求
openclaw pairing list feishu

# 批准配对
openclaw pairing approve feishu <CODE>
```

---

## ✅ 完成检查后

请回复贾维斯：**"飞书配置检查完毕"**

然后贾维斯会：
1. 启用插件
2. 重启网关
3. 监控启动状态
4. 报告结果

---

**维护者**: Jarvis (贾维斯) ⚡
**状态**: 等待飞书平台配置检查
