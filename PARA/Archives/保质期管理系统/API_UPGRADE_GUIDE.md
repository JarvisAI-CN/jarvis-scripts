# ä¿è´¨æœŸç®¡ç†ç³»ç»Ÿ - APIæ¥å£å‡çº§æŒ‡å—

**ç‰ˆæœ¬**: v2.9.0 (APIæ¥å£ç‰ˆæœ¬)
**å‡çº§æ—¥æœŸ**: 2026-02-18
**å¼€å‘è€…**: è´¾ç»´æ–¯ âš¡

---

## ğŸ¯ å‡çº§ç›®æ ‡

ä¸ºä¿è´¨æœŸç®¡ç†ç³»ç»Ÿæ·»åŠ **RESTful APIæ¥å£**ï¼Œè®©AIåŠ©æ‰‹ï¼ˆè´¾ç»´æ–¯ï¼‰å¯ä»¥é€šè¿‡APIå¯†é’¥è®¿é—®ç«™ç‚¹æ•°æ®ï¼Œè¿›è¡Œæ™ºèƒ½åˆ†æå’Œæ±‡æ€»ï¼Œ**æ— éœ€é¢å¤–é…ç½®AIåŠŸèƒ½**ã€‚

**ä¿ç•™ç°æœ‰åŠŸèƒ½**: åå°AIåŠŸèƒ½å®Œå…¨ä¿ç•™ï¼Œå…¶ä»–äººç»§ç»­æ­£å¸¸ä½¿ç”¨ã€‚

---

## âœ¨ æ–°åŠŸèƒ½æ¦‚è§ˆ

### 1. APIå¯†é’¥ç®¡ç†ç³»ç»Ÿ
- âœ… åå°ç”Ÿæˆ/ç®¡ç†APIå¯†é’¥
- âœ… å¯†é’¥æƒé™æ§åˆ¶
- âœ… ä½¿ç”¨æ—¥å¿—è¿½è¸ª
- âœ… çŠ¶æ€åˆ‡æ¢ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

### 2. RESTful APIæ¥å£
- âœ… æ ‡å‡†HTTPæ¥å£
- âœ… Bearer Tokenè®¤è¯
- âœ… JSONæ•°æ®æ ¼å¼
- âœ… å¤šç«¯ç‚¹æ”¯æŒ

### 3. Python APIå®¢æˆ·ç«¯
- âœ… å¼€ç®±å³ç”¨çš„Pythonè„šæœ¬
- âœ… è‡ªåŠ¨æ•°æ®æ±‡æ€»
- âœ… AIå‹å¥½æ ¼å¼è¾“å‡º
- âœ… å‘½ä»¤è¡Œå·¥å…·

---

## ğŸ“¦ å‡çº§å†…å®¹

### æ–°å¢æ–‡ä»¶

| æ–‡ä»¶å | ç”¨é€” |
|--------|------|
| `api.php` | APIæ•°æ®æ¥å£ï¼ˆ6ä¸ªendpointï¼‰ |
| `api_key_manager.php` | APIå¯†é’¥ç®¡ç†æ ¸å¿ƒå‡½æ•° |
| `api_keys.php` | APIå¯†é’¥ç®¡ç†é¡µé¢ï¼ˆWebç•Œé¢ï¼‰ |
| `api_keys.sql` | æ•°æ®åº“å‡çº§è„šæœ¬ |
| `scripts/expiry_api_client.py` | Python APIå®¢æˆ·ç«¯ |
| `upgrade_to_api.sh` | ä¸€é”®å‡çº§è„šæœ¬ |

---

## ğŸš€ å‡çº§æ­¥éª¤

### æ­¥éª¤1: å¤‡ä»½æ•°æ®åº“

```bash
# å¯¼å‡ºæ•°æ®åº“
mysqldump -uç”¨æˆ·å -på¯†ç  expiry_system > backup_$(date +%Y%m%d).sql
```

### æ­¥éª¤2: æ‰§è¡Œæ•°æ®åº“å‡çº§

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/ubuntu/.openclaw/workspace/PARA/Archives/ä¿è´¨æœŸç®¡ç†ç³»ç»Ÿ

# æ‰§è¡ŒSQLè„šæœ¬
mysql -uç”¨æˆ·å -på¯†ç  expiry_system < api_keys.sql
```

### æ­¥éª¤3: ä¸Šä¼ æ–°æ–‡ä»¶åˆ°æœåŠ¡å™¨

```bash
# å¦‚æœæ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œä½¿ç”¨scpæˆ–sftpä¸Šä¼ 
# æˆ–è€…åœ¨å®å¡”é¢æ¿æ–‡ä»¶ç®¡ç†å™¨ä¸­ä¸Šä¼ 
```

### æ­¥éª¤4: è®¿é—®APIç®¡ç†é¡µé¢

```
http://ä½ çš„åŸŸå/api_keys.php
```

### æ­¥éª¤5: åˆ›å»ºAPIå¯†é’¥

1. ç‚¹å‡»"åˆ›å»ºæ–°å¯†é’¥"
2. è¾“å…¥å¯†é’¥åç§°ï¼ˆä¾‹å¦‚ï¼š"è´¾ç»´æ–¯è®¿é—®å¯†é’¥"ï¼‰
3. ç‚¹å‡»"åˆ›å»º"
4. **é‡è¦**: å¤åˆ¶ç”Ÿæˆçš„APIå¯†é’¥å¹¶ä¿å­˜

---

## ğŸ“– APIæ¥å£æ–‡æ¡£

### è®¤è¯æ–¹å¼

åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ :

```
Authorization: Bearer YOUR_API_KEY
```

### æ”¯æŒçš„Endpoint

#### 1. summary - æ±‡æ€»ç»Ÿè®¡
```bash
GET /api.php?endpoint=summary
```

è¿”å›æ•°æ®:
```json
{
  "success": true,
  "statistics": {
    "total_products": 100,
    "total_batches": 250,
    "total_stock": 5000,
    "expired": 5,
    "critical": 10,
    "warning": 25
  }
}
```

#### 2. products - æ‰€æœ‰äº§å“
```bash
GET /api.php?endpoint=products
```

#### 3. batches - æ‰€æœ‰æ‰¹æ¬¡
```bash
GET /api.php?endpoint=batches
```

#### 4. expiring - å³å°†è¿‡æœŸ
```bash
GET /api.php?endpoint=expiring&days=30
```

#### 5. categories - åˆ†ç±»æ•°æ®
```bash
GET /api.php?endpoint=categories
```

#### 6. all - å®Œæ•´å¯¼å‡º
```bash
GET /api.php?endpoint=all
```

---

## ğŸ Pythonå®¢æˆ·ç«¯ä½¿ç”¨

### å®‰è£…ä¾èµ–

```bash
pip3 install requests
```

### åŸºæœ¬ä½¿ç”¨

```python
from expiry_api_client import ExpiryAPI

# åˆ›å»ºå®¢æˆ·ç«¯
client = ExpiryAPI(
    base_url="http://ceshi.dhmip.cn",
    api_key="your_api_key_here"
)

# è·å–æ±‡æ€»ç»Ÿè®¡
summary = client.get_summary()
print(summary)

# ç”ŸæˆAIå‹å¥½æŠ¥å‘Š
report = client.generate_report()
print(report)

# è·å–éœ€è¦å¤„ç†çš„é¡¹ç›®
critical = client.get_critical_items()
print(f"å·²è¿‡æœŸ: {len(critical['expired'])}")
print(f"7å¤©å†…è¿‡æœŸ: {len(critical['critical'])}")
```

### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ç”ŸæˆæŠ¥å‘Š
python3 /home/ubuntu/.openclaw/workspace/scripts/expiry_api_client.py \
  http://ceshi.dhmip.cn \
  YOUR_API_KEY
```

---

## ğŸ¤– è´¾ç»´æ–¯é›†æˆ

ä¸»äººï¼Œå½“ä½ åˆ›å»ºå¥½APIå¯†é’¥åï¼Œå‘Šè¯‰æˆ‘ï¼š

```
ä¸»äººï¼šç«™ç‚¹æ˜¯ http://ceshi.dhmip.cnï¼ŒAPIå¯†é’¥æ˜¯ xxxxxx
```

æˆ‘å°±èƒ½ï¼š
1. è‡ªåŠ¨è®¿é—®ä½ çš„ä¿è´¨æœŸæ•°æ®
2. ç”Ÿæˆæ™ºèƒ½æ±‡æ€»æŠ¥å‘Š
3. åˆ†æè¿‡æœŸé£é™©
4. æå‡ºå¤„ç†å»ºè®®

**ç¤ºä¾‹å¯¹è¯**:

```
ä½ : å¸®æˆ‘çœ‹çœ‹ä¿è´¨æœŸç³»ç»Ÿæœ‰ä»€ä¹ˆéœ€è¦å¤„ç†çš„

è´¾ç»´æ–¯: æˆ‘æ¥æ£€æŸ¥ä¸€ä¸‹...
      âœ… å·²è·å–æ•°æ®
      ğŸ“Š æ€»å•†å“: 150ä¸ª
      âš ï¸  5ä¸ªå·²è¿‡æœŸ
      ğŸ”´ 12ä¸ª7å¤©å†…è¿‡æœŸ
      ğŸ’¡ å»ºè®®: ç«‹å³å¤„ç†å·²è¿‡æœŸçš„5ä¸ªå•†å“...
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¿æŠ¤APIå¯†é’¥** - ä¸è¦åœ¨å…¬å¼€ä»£ç ä¸­æš´éœ²
2. **è®¾ç½®è¿‡æœŸæ—¶é—´** - ä¸´æ—¶å¯†é’¥å»ºè®®è®¾ç½®è¿‡æœŸæ—¥æœŸ
3. **å®šæœŸè½®æ¢** - é‡è¦å¯†é’¥å®šæœŸæ›´æ¢
4. **ç›‘æ§æ—¥å¿—** - å®šæœŸæŸ¥çœ‹APIè®¿é—®æ—¥å¿—
5. **IPç™½åå•** (å¯é€‰) - é™åˆ¶APIè®¿é—®æ¥æºIP

---

## ğŸ“Š ç°æœ‰åŠŸèƒ½ä¿ç•™

**åå°AIåŠŸèƒ½å®Œå…¨ä¿ç•™**ï¼

- âœ… ç°æœ‰çš„AI OCRè¯†åˆ«åŠŸèƒ½ä¸å—å½±å“
- âœ… AIé”€å”®æ–¹æ¡ˆç”ŸæˆåŠŸèƒ½æ­£å¸¸ä½¿ç”¨
- âœ… å…¶ä»–ç®¡ç†å‘˜åŠŸèƒ½å…¨éƒ¨ä¿ç•™
- âœ… åªæ–°å¢äº†APIæ¥å£ï¼Œä¸æ”¹å˜ç°æœ‰é€»è¾‘

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: APIè¿”å›401/403é”™è¯¯

**åŸå› **: APIå¯†é’¥æ— æ•ˆæˆ–å·²ç¦ç”¨

**è§£å†³**:
1. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®å¤åˆ¶
2. ç¡®è®¤å¯†é’¥çŠ¶æ€ä¸º"å¯ç”¨"
3. æ£€æŸ¥å¯†é’¥æ˜¯å¦å·²è¿‡æœŸ

### é—®é¢˜2: APIè¿”å›ç©ºæ•°æ®

**åŸå› **: æ•°æ®åº“ä¸­æ— æ•°æ®æˆ–æƒé™é—®é¢˜

**è§£å†³**:
1. ç¡®è®¤æ•°æ®åº“ä¸­æœ‰æ•°æ®
2. æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®
3. æŸ¥çœ‹APIæ—¥å¿—è¡¨

### é—®é¢˜3: Pythonè„šæœ¬æŠ¥é”™

**åŸå› **: ç¼ºå°‘requestsåº“

**è§£å†³**:
```bash
pip3 install requests
```

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.9.0 (2026-02-18)
- âœ¨ æ–°å¢APIå¯†é’¥ç®¡ç†ç³»ç»Ÿ
- âœ¨ æ–°å¢RESTful APIæ¥å£ï¼ˆ6ä¸ªendpointï¼‰
- âœ¨ æ–°å¢Python APIå®¢æˆ·ç«¯
- âœ¨ æ–°å¢APIè®¿é—®æ—¥å¿—åŠŸèƒ½
- ğŸ“ å®Œå–„APIä½¿ç”¨æ–‡æ¡£
- ğŸ”’ APIå¯†é’¥SHA256å“ˆå¸Œå­˜å‚¨
- ğŸ”’ Bearer Tokenè®¤è¯

---

## ğŸ’¡ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] æ·»åŠ Webhooké€šçŸ¥åŠŸèƒ½
- [ ] æ”¯æŒæ‰¹é‡æ•°æ®å¯¼å…¥API
- [ ] æ·»åŠ æ•°æ®å¯¼å‡ºï¼ˆCSV/Excelï¼‰
- [ ] APIé€Ÿç‡é™åˆ¶
- [ ] IPç™½åå•åŠŸèƒ½

---

**å¼€å‘è€…**: è´¾ç»´æ–¯ âš¡
**æ”¯æŒ**: jarvis.openclaw@email.cn
**é¡¹ç›®**: ä¿è´¨æœŸç®¡ç†ç³»ç»Ÿ v2.9.0
