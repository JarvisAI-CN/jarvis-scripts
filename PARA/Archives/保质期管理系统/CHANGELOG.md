# 更新日志 (CHANGELOG)

## [v2.8.2] - 2026-02-18

### 🔒 安全修复（重要！）

**升级接口安全加固**
- ✅ `check_upgrade` 和 `execute_upgrade` 接口现在需要管理员权限
- ✅ 禁用远程自动升级功能，防止未授权代码执行
- ✅ 升级源从外部 GitHub 改为安全的内网源（飞书）

**SQL注入漏洞修复**
- ✅ `submit_session` 接口使用 prepared statement
- ✅ `get_session_details` 接口使用 prepared statement
- ✅ 所有用户输入都经过参数化查询

**版本号统一**
- ✅ VERSION.txt 更新为 2.8.2
- ✅ APP_VERSION 常量更新为 2.8.2
- ✅ 所有版本号现在一致

### 🎨 UI 改进 - 淡蓝苹果风格

**全新视觉设计**
- ✨ 苹果风格配色：#007AFF（苹果蓝）
- ✨ 淡蓝渐变背景：#E3F2FD → #BBDEFB
- ✨ 更大的圆角：16px（卡片、按钮）
- ✨ 毛玻璃效果：header 使用 backdrop-filter
- ✨ 更柔和的阴影和过渡动画

**交互体验优化**
- ✨ 按钮悬停效果更流畅
- ✨ 输入框聚焦时的蓝色光晕
- ✨ 统一的视觉语言

### 🔧 技术改进

- 禁用外部 UPDATE_URL，改用安全的内网更新
- 所有数据库查询使用 prepared statements
- 增强的权限检查逻辑

### 🐛 已知问题

- 自动升级功能暂时禁用（需要手动上传升级包）
- 计划在 v2.9 中实现"自动下载+手动确认"的升级机制

---

## [v2.8.1] - 2026-02-18

### 🆕 新增功能

**API接口系统**
- ✨ RESTful API接口 (`api.php`)
  - 支持6个数据端点：summary, products, batches, expiring, categories, all
  - Bearer Token认证机制
  - JSON数据格式输出
  - 自动CORS支持

**API密钥管理**
- ✨ API密钥管理页面 (`api_keys.php`)
  - 密钥创建、删除、启用/禁用
  - 使用日志查看
  - 最后使用时间追踪
  - SHA256哈希存储

**Python API客户端**
- ✨ 开箱即用的客户端 (`scripts/expiry_api_client.py`)
  - 自动数据汇总
  - AI友好格式输出
  - 命令行工具支持

### 📝 文档更新
- 新增 `API_UPGRADE_GUIDE.md` - API升级指南
- 新增 `api_keys.sql` - 数据库升级脚本
- 更新 `README.md` - 添加API功能说明
- 新增 `api_key_manager.php` - API管理核心函数

### 🔧 技术改进
- API访问日志表 (`api_logs`)
- API密钥表 (`api_keys`)
- 请求参数验证
- 错误处理优化

### 🐛 Bug修复
- 修复dashboard.php在某些情况下的布局问题
- 优化API响应速度

---

## [v2.8.0-alpha] - 2026-02-17

### 🆕 新增功能

**智能管理看板**
- ✨ 统一管理仪表板 (`dashboard.php`)
  - 集成所有功能入口
  - 数据可视化展示
  - 快捷操作面板

**多维度数据展示**
- ✨ 按分类统计
- ✨ 按效期状态统计
- ✨ 按库存周转统计

**快捷功能**
- ✨ 一键导出
- ✨ 批量操作
- ✨ 快速搜索

### 🔧 技术改进
- 优化数据库查询性能
- 增加缓存机制
- 改进响应式布局

### 🐛 Bug修复
- 修复移动端显示问题
- 修复SKU搜索bug

---

## [v2.7.3-alpha] - 2026-02-16

### 🐛 Bug修复
- 修复条形码扫描在部分设备上不工作的问题
- 优化摄像头权限请求流程

### 🔧 技术改进
- 升级 html5-qrcode 库到 v2.3.8
- 改进错误提示信息

---

## [v2.7.0-alpha] - 2026-02-15

### 🆕 新增功能

**移动端扫码录入**
- ✨ 支持摄像头扫描条形码/二维码
- ✨ SKU自动填充
- ✨ 离线缓存支持

**智能批次管理**
- ✨ 自动计算临期日期
- ✨ 多批次同时录入
- ✨ 批次状态标记（临期/过期）

**盘点会话管理**
- ✨ 按会话组织盘点任务
- ✨ 会话历史记录
- ✨ 会话明细查看

**商品分类系统**
- ✨ 自定义分类
- ✨ 分类规则配置
  - 是否需要缓冲期
  - 撤架是否报废
  - 是否允许赠品
- ✨ 自动应用分类规则

### 📝 文档更新
- 新增用户手册
- 新增部署指南
- 新增API文档

### 🔧 技术改进
- 响应式设计优化
- 移动端触摸优化
- 数据库自动迁移

---

## [v2.6.0] - 2026-02-14

### 🆕 新增功能
- 基础商品管理功能
- 批次管理功能
- 效期计算功能
- 基础UI界面

### 📝 初始版本
- 核心功能实现
- 数据库设计
- 基础架构搭建
