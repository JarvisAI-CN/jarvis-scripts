# 保质期管理系统 - 部署指南

**创建时间**: 2026-02-15
**目标域名**: ceshi.dhmip.cn
**技术栈**: PHP 8.3 + MySQL 5.7

---

## 📦 部署文件清单

### 核心文件
1. `db.php` - 数据库连接配置
2. `index.php` - 主程序（扫码+管理界面）
3. `database.sql` - 数据库初始化脚本

---

## 🚀 部署步骤

### 第一步：登录宝塔面板

1. **访问地址**: http://82.157.20.7:8888/fs123456
2. **登录账号**:
   - 用户名: `fs123`
   - 密码: `fs123456`

---

### 第二步：配置数据库

1. **左侧菜单** → **数据库**
2. **点击**: 添加数据库
3. **填写信息**:
   - 数据库名: `expiry_system`
   - 用户名: `expiry_user`
   - 密码: `Expiry@2026System!`
   - 访问权限: 本地服务器
4. **点击**: 提交

5. **点击数据库名** → **导入** → **上传SQL文件**
6. **选择**: `database.sql` → **导入**

---

### 第三步：上传网站文件

1. **左侧菜单** → **网站**
2. **找到**: `ceshi.dhmip.cn` → **点击根目录**
3. **删除**: 默认的 `index.html`（如果存在）
4. **上传文件**:
   - `db.php`
   - `index.php`

5. **编辑 `db.php`**，修改数据库密码:
   ```php
   define('DB_PASS', 'Expiry@2026System!');
   define('DB_NAME', 'expiry_system');
   define('DB_USER', 'expiry_user');
   ```

---

### 第四步：配置PHP设置

1. **网站** → **ceshi.dhmip.cn** → **PHP设置**
2. **确认**: PHP版本 >= 7.4（推荐 8.x）
3. **禁用函数** → 删除以下函数（如果存在）:
   - `exec`
   - `shell_exec`
   - `passthru`
   - `system`
   - `proc_open`
   - `popen`

**注意**: 扫码功能不需要这些函数，但建议保持默认配置。

---

### 第五步：测试访问

1. **打开浏览器**: http://ceshi.dhmip.cn
2. **测试功能**:
   - [ ] 页面正常加载
   - [ ] 扫码按钮可用（需HTTPS或localhost）
   - [ ] 手动输入SKU测试
   - [ ] 添加批次功能
   - [ ] 查询功能

---

## 🔧 SSL证书配置（可选）

如需HTTPS支持：

1. **网站** → **ceshi.dhmip.cn** → **SSL**
2. **选择**: Let's Encrypt
3. **点击**: 申请
4. **等待**: 证书颁发成功

**HTTPS访问**: https://ceshi.dhmip.cn

---

## 📱 移动端测试

### 扫码功能要求
- ✅ HTTPS（必须）
- ✅ 摄像头权限
- ✅ 现代浏览器（Chrome/Safari）

### 测试SKU
可使用以下测试数据：
- SKU: `6901234567890` → 可口可乐 500ml
- SKU: `6901234567891` → 康师傅红烧牛肉面

---

## ⚠️ 常见问题

### 1. 扫码无法启动
**原因**: HTTP环境下浏览器限制摄像头访问
**解决**: 申请SSL证书使用HTTPS

### 2. 数据库连接失败
**检查**:
- 数据库用户名密码是否正确
- 数据库服务是否运行
- `db.php` 配置是否正确

### 3. 页面显示错误
**检查**:
- PHP版本是否 >= 7.4
- 错误日志: 网站日志 → 错误日志

---

## 📊 数据库结构

### products（商品表）
- `id` - 商品ID（主键）
- `sku` - 商品SKU/条形码（唯一）
- `name` - 商品名称
- `created_at` - 创建时间
- `updated_at` - 更新时间

### batches（批次表）
- `id` - 批次ID（主键）
- `product_id` - 关联商品ID（外键）
- `expiry_date` - 到期日期
- `quantity` - 数量
- `created_at` - 创建时间
- `updated_at` - 更新时间

---

## 🎯 下一步优化

- [ ] 添加用户认证（登录系统）
- [ ] 数据导出功能（CSV/Excel）
- [ ] 到期提醒通知
- [ ] 条形码生成打印
- [ ] 库存预警功能

---

**部署完成后请通知贾维斯进行验收测试！** ⚡
