# æµ‹è¯•æ¡†æ¶ä½¿ç”¨æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2026-02-14
**æ¡†æ¶è·¯å¾„**: `è¿™ä¸ªé¡¹ç›®çš„æ–‡ä»¶/ä»£ç /test_framework.py`

---

## ğŸ“– å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³•

```python
from test_framework import TestCase, TestRunner, TestReporter, run_tests

# 1. å®šä¹‰æµ‹è¯•ç”¨ä¾‹
class MyTest(TestCase):
    def setup(self):
        """æµ‹è¯•å‰å‡†å¤‡"""
        self.data = prepare_test_data()

    def run_test(self):
        """å®é™…æµ‹è¯•é€»è¾‘"""
        self.assert_equal(self.data["status"], "ok")
        self.assert_true(len(self.data["items"]) > 0)

    def teardown(self):
        """æµ‹è¯•åæ¸…ç†"""
        cleanup_test_data(self.data)

# 2. è¿è¡Œæµ‹è¯•
test = MyTest(name="My First Test")
result = test.execute()
print(f"Test status: {result.status.value}")
```

### æ‰¹é‡è¿è¡Œ

```python
# åˆ›å»ºæµ‹è¯•å¥—ä»¶
runner = TestRunner(suite_name="My Test Suite")
runner.add_test(MyTest(name="Test 1"))
runner.add_test(MyTest(name="Test 2"))

# å¹¶å‘æ‰§è¡Œ
result = runner.run_parallel()

# ç”ŸæˆæŠ¥å‘Š
reporter = TestReporter(result)
reporter.to_console()
reporter.to_json(Path("test_results/report.json"))
```

### ä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰

```python
# æœ€ç®€å•çš„ç”¨æ³•
run_tests(
    test_cases=[MyTest(name="Test 1"), MyTest(name="Test 2")],
    suite_name="My Suite",
    parallel=True,
    output_json=Path("test_results/report.json"),
    send_feishu=True,
    feishu_webhook="https://open.feishu.cn/open-apis/bot/v2/hook/..."
)
```

---

## ğŸ¯ æ ¸å¿ƒ API

### TestCase ç±»

æµ‹è¯•ç”¨ä¾‹åŸºç±»ï¼Œæ‰€æœ‰æµ‹è¯•å¿…é¡»ç»§æ‰¿æ­¤ç±»ã€‚

#### å¿…é¡»å®ç°çš„æ–¹æ³•

- `setup(self) -> None`: æµ‹è¯•å‰å‡†å¤‡
- `run_test(self) -> None`: æµ‹è¯•é€»è¾‘ï¼ˆæ ¸å¿ƒï¼‰
- `teardown(self) -> None`: æµ‹è¯•åæ¸…ç†

#### æ–­è¨€æ–¹æ³•

```python
# æ–­è¨€ç›¸ç­‰
self.assert_equal(actual, expected, "Custom message")

# æ–­è¨€ä¸ºçœŸ
self.assert_true(condition, "Should be true")

# æ–­è¨€åŒ…å«
self.assert_in(item, container, "Item should be in container")

# æ–­è¨€æŠ›å‡ºå¼‚å¸¸
self.assert_raises(ValueError, risky_function, arg1, arg2)
```

#### è·³è¿‡æµ‹è¯•

```python
def setup(self):
    if not is_environment_ready():
        self.skip("Environment not ready")
```

### TestRunner ç±»

æµ‹è¯•è¿è¡Œå™¨ï¼Œç®¡ç†å¤šä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ‰§è¡Œã€‚

#### ä¸»è¦æ–¹æ³•

- `add_test(test_case)`: æ·»åŠ å•ä¸ªæµ‹è¯•
- `add_tests(test_cases)`: æ‰¹é‡æ·»åŠ æµ‹è¯•
- `run_sequential()`: é¡ºåºæ‰§è¡Œ
- `run_parallel()`: å¹¶å‘æ‰§è¡Œ

#### å¹¶å‘æ§åˆ¶

```python
runner = TestRunner(
    suite_name="My Suite",
    max_workers=8  # æœ€å¤š8ä¸ªå¹¶å‘
)
```

### TestReporter ç±»

æŠ¥å‘Šç”Ÿæˆå™¨ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ã€‚

#### æŠ¥å‘Šæ ¼å¼

```python
reporter = TestReporter(result)

# 1. ç»ˆç«¯è¾“å‡ºï¼ˆå½©è‰²ï¼‰
reporter.to_console()

# 2. JSON æŠ¥å‘Š
reporter.to_json(Path("report.json"))

# 3. é£ä¹¦é€šçŸ¥
reporter.send_to_feishu(webhook_url="...")
```

---

## ğŸ“Š æµ‹è¯•ç»“æœ

### TestCaseResult ç»“æ„

```python
{
    "name": "æµ‹è¯•åç§°",
    "status": "passed|failed|skipped|error",
    "duration": 1.234,  # ç§’
    "error_message": "é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰",
    "error_trace": "å †æ ˆè·Ÿè¸ªï¼ˆå¦‚æœæœ‰ï¼‰",
    "steps": [...],  # æµ‹è¯•æ­¥éª¤åˆ—è¡¨
    "metadata": {...}  # è‡ªå®šä¹‰å…ƒæ•°æ®
}
```

### TestSuiteResult ç»“æ„

```python
{
    "suite_name": "æµ‹è¯•å¥—ä»¶åç§°",
    "total": 10,
    "passed": 8,
    "failed": 1,
    "skipped": 1,
    "errors": 0,
    "duration": 12.345,
    "success_rate": 80.0,
    "test_cases": [...]  # è¯¦ç»†æµ‹è¯•ç»“æœ
}
```

---

## ğŸ¨ é«˜çº§ç”¨æ³•

### å‚æ•°åŒ–æµ‹è¯•

```python
class ParameterizedTest(TestCase):
    def __init__(self, name: str, test_data: dict):
        super().__init__(name)
        self.test_data = test_data

    def run_test(self):
        self.assert_equal(self.test_data["input"], self.test_data["expected"])

# æ‰¹é‡åˆ›å»ºæµ‹è¯•
test_data = [
    {"input": 1, "expected": 1},
    {"input": 2, "expected": 2},
]

tests = [
    ParameterizedTest(f"Test-{i}", data)
    for i, data in enumerate(test_data)
]

run_tests(tests)
```

### æµ‹è¯•æ­¥éª¤è®°å½•

```python
def run_test(self):
    step1 = "æ­¥éª¤1ï¼šåˆå§‹åŒ–"
    self.add_step(step1, TestStatus.PASSED)

    try:
        # å®é™…æ“ä½œ
        result = do_something()
        self.add_step("æ­¥éª¤2ï¼šæ‰§è¡Œæ“ä½œ", TestStatus.PASSED)
    except Exception as e:
        self.add_step("æ­¥éª¤2ï¼šæ‰§è¡Œæ“ä½œ", TestStatus.FAILED, str(e))
        raise
```

### é£ä¹¦é›†æˆ

```python
# é…ç½®é£ä¹¦ webhookï¼ˆåœ¨ test_config.yaml ä¸­ï¼‰
feishu:
  webhook_url: "https://open.feishu.cn/open-apis/bot/v2/hook/..."
  notify_on_failure: true
  notify_on_success: false

# æˆ–ç›´æ¥åœ¨ä»£ç ä¸­é…ç½®
run_tests(
    test_cases=tests,
    send_feishu=True,
    feishu_webhook=os.getenv("FEISHU_WEBHOOK")
)
```

---

## ğŸ§ª æœ€ä½³å®è·µ

1. **å‘½åè§„èŒƒ**: æµ‹è¯•ç”¨ä¾‹åç§°åº”è¯¥æ¸…æ™°æè¿°æµ‹è¯•å†…å®¹
   ```python
   class UserLoginTest(TestCase):  # âœ… å¥½
   class Test1(TestCase):  # âŒ ä¸å¥½
   ```

2. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åº”è¯¥ç‹¬ç«‹è¿è¡Œ
   ```python
   def setup(self):
       # æ¯ä¸ªæµ‹è¯•éƒ½æœ‰ç‹¬ç«‹çš„æ•°æ®
       self.user_id = generate_unique_user_id()
   ```

3. **è¶…æ—¶è®¾ç½®**: ä¸ºè€—æ—¶æµ‹è¯•è®¾ç½®è¶…æ—¶
   ```python
   test = MyTest(timeout=60.0)  # 60ç§’è¶…æ—¶
   ```

4. **å¹¶å‘å‹å¥½**: é¿å…å…±äº«èµ„æºï¼Œæˆ–ä½¿ç”¨é”
   ```python
   def setup(self):
       self.temp_dir = tempfile.mkdtemp()  # æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹çš„ä¸´æ—¶ç›®å½•
   ```

5. **æ¸…ç†èµ„æº**: å§‹ç»ˆåœ¨ teardown ä¸­æ¸…ç†
   ```python
   def teardown(self):
       if hasattr(self, 'temp_dir'):
           shutil.rmtree(self.temp_dir, ignore_errors=True)
   ```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å¹¶å‘æ‰§è¡Œ

```python
# å¯¹äºç‹¬ç«‹æµ‹è¯•ï¼Œä½¿ç”¨å¹¶å‘åŠ é€Ÿ
result = runner.run_parallel()  # æ¯”é¡ºåºå¿« 2-4 å€
```

### è½»é‡çº§ setup

```python
def setup(self):
    # åªåšå¿…è¦çš„åˆå§‹åŒ–
    self.client = get_shared_client()  # è€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºæ–°è¿æ¥
```

### è·³è¿‡æ…¢é€Ÿæµ‹è¯•

```python
def setup(self):
    if os.getenv("SKIP_SLOW_TESTS"):
        self.skip("Slow test skipped")
```

---

## ğŸ› æ•…éšœæ’é™¤

### æµ‹è¯•ä¸€ç›´å¤±è´¥

æ£€æŸ¥ setup æ˜¯å¦æ­£ç¡®ï¼Œç¯å¢ƒæ˜¯å¦å‡†å¤‡å¥½ï¼š
```python
def setup(self):
    assert is_database_connected(), "Database not connected!"
```

### å¹¶å‘æµ‹è¯•æœ‰é—®é¢˜

å°è¯•é¡ºåºæ‰§è¡Œï¼Œçœ‹æ˜¯å¦æ˜¯å¹¶å‘é—®é¢˜ï¼š
```python
result = runner.run_sequential()  # å¦‚æœé¡ºåºé€šè¿‡ï¼Œè¯´æ˜æœ‰å¹¶å‘é—®é¢˜
```

### æ‰¾ä¸åˆ°é”™è¯¯åŸå› 

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

- æ–‡æ¡£ä½ç½®: `è¿™ä¸ªé¡¹ç›®çš„æ–‡ä»¶/æ–‡æ¡£/æ¡†æ¶ä½¿ç”¨æ–‡æ¡£.md`
- æ¡†æ¶ä»£ç : `è¿™ä¸ªé¡¹ç›®çš„æ–‡ä»¶/ä»£ç /test_framework.py`
- é…ç½®ç¤ºä¾‹: `è¿™ä¸ªé¡¹ç›®çš„æ–‡ä»¶/é…ç½®/test_config.yaml`

---

**æœ€åæ›´æ–°**: 2026-02-14
**ç‰ˆæœ¬**: v1.0
**ç»´æŠ¤è€…**: è´¾ç»´æ–¯ (Jarvis) âš¡
