# 工作流程自动化文档

## 概述
本文档定义了 OpenClaw 系统中任务和工作流程的自动化执行方式。

## 🔄 3-Agent工作流 vs 直接处理

### 工作方式选择原则

**方案1+方案2组合模式**：
- **方案1**：用户可以明确指示使用哪种工作方式
- **方案2**：我会根据任务复杂度主动评估并提供建议
- **双方都可以自主选择**最合适的工作方式

### 适合使用3-Agent工作流的场景

✅ **建议使用3-Agent工作流**：
- 新功能开发 (涉及>3个文件)
- 复杂重构 (架构层面变更)
- 数据库结构变更
- 安全相关的功能
- 需要专业代码审查的功能

✅ **我会主动建议使用3-Agent**：
当遇到上述复杂场景时，我会主动询问：
> "这个功能比较复杂，建议使用3-Agent工作流来保证质量。您觉得如何？"

### 适合直接处理的场景

✅ **直接处理更高效**：
- 小bug修复 (<50行代码)
- UX调整和界面优化
- 配置更改
- 单文件修改
- 紧急hotfix

✅ **我会直接处理**：
对于简单任务，我会直接处理并简要说明：
> "这是一个小调整，我直接修复了。"

### 用户明确指示

您可以随时明确指示：
- "用3-Agent工作流来处理这个功能" → 启动完整流程
- "这个直接处理就行" → 快速解决
- "先用项目经理分析一下" → 仅使用Agent A分析

## 🤖 3-Agent工作流执行流程

当使用3-Agent工作流时：

### Agent A - 项目经理
- **职责**：需求分析、架构设计、接口规范
- **输出**：模块化架构图、接口契约、目录结构
- **模型**：volcengine/ark-code-latest → Gemini-3 Flash → 智谱4.7

### Agent B - 资深程序员  
- **职责**：代码实现、TDD测试、Bug修复
- **输出**：实现代码、单元测试、依赖分析
- **模型**：zhipu/glm-4.7 (稳定可靠)

### Agent C - 测试审计
- **职责**：代码审查、回归分析、安全审计
- **输出**：审计报告、风险评估、安全扫描结果
- **模型**：openai-codex/gpt-5.3-codex (代码优化专家)

### 执行顺序
1. **项目经理** 分析需求 → 设计架构
2. **程序员** 按接口契约实现代码
3. **审计** 审查代码质量 → 通过后部署

## 工作流程类型

### 1. 每日任务
- 时间：每天 00:00 - 05:00
- 类型：知识整理、内容准备、学习提升、系统维护
- 执行文件：execute-nightly-learning.sh
- 触发条件：/tmp/nightly-learning/status 文件存在且内容为 "pending"

### 2. 每小时任务
- 时间：每小时 00:00
- 类型：代码扫描、文档优化、日志分析、知识整理
- 执行文件：zhipu_scheduler.py
- 触发条件：Cron 定时任务

### 3. 每两小时任务
- 时间：每两小时
- 类型：系统巡检、安全扫描、性能分析
- 执行文件：backup.sh、github_status_check.sh
- 触发条件：Cron 定时任务

### 4. 每日任务（09:00）
- 时间：每天 09:00
- 类型：Agent 健康检查、项目状态检查
- 执行文件：agent_health_check.sh
- 触发条件：Cron 定时任务

## 任务执行流程

### 任务创建
- 任务定义：在 execute-nightly-learning.sh 中定义
- 任务分配：根据时间和类型分配任务
- 任务执行：自动执行任务

### 任务监控
- 日志文件：/home/ubuntu/.openclaw/workspace/logs/
- 状态文件：/tmp/nightly-learning/status
- 错误处理：任务失败时记录到日志

### 任务完成
- 状态更新：任务完成后更新状态文件
- 报告生成：生成任务报告

## 工作流程优化

### 任务优先级
- 01:05 成本报告
- 01:10 技能发现
- 01:15 GitHub 状态检查
- 01:20 Agent 健康检查

### 任务执行策略
- 凌晨 01:00 - 05:00：低 API 消耗任务
- 白天：高价值产出任务
- 持续任务：不受时间限制任务

## 相关文件
- execute-nightly-learning.sh：任务执行脚本
- zhipu_scheduler.py：任务调度器
- github_status_check.sh：GitHub 状态检查
- agent_health_check.sh：Agent 健康检查
- backup.sh：备份脚本
- pre_commit_check.sh：Git 提交前检查
